From 06739f51b54ec43ef02a689c0987b8e472fa4dbf Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?S=C3=A9bastien=20Delafond?= <sdelafond@gmail.com>
Date: Thu, 9 Jan 2020 15:51:24 +0100
Subject: [PATCH 8/9] 4.14 ct id

---
 include/uapi/linux/netfilter/nf_tables.h | 1 +
 net/netfilter/nft_ct.c                   | 8 ++++++++
 2 files changed, 9 insertions(+)

diff --git a/include/uapi/linux/netfilter/nf_tables.h b/include/uapi/linux/netfilter/nf_tables.h
index 325ec6e..5399673 100644
--- a/include/uapi/linux/netfilter/nf_tables.h
+++ b/include/uapi/linux/netfilter/nf_tables.h
@@ -830,6 +830,7 @@ enum nft_meta_keys {
 enum nft_rt_keys {
 	NFT_RT_CLASSID,
 	NFT_RT_NEXTHOP4,
+	NFT_CT_ID,
 	NFT_RT_NEXTHOP6,
 	NFT_RT_TCPMSS,
 	__NFT_RT_MAX
diff --git a/net/netfilter/nft_ct.c b/net/netfilter/nft_ct.c
index 5dd8774..17e96b6 100644
--- a/net/netfilter/nft_ct.c
+++ b/net/netfilter/nft_ct.c
@@ -82,6 +82,11 @@ static void nft_ct_get_eval(const struct nft_expr *expr,
 			state = NF_CT_STATE_INVALID_BIT;
 		*dest = state;
 		return;
+	case NFT_CT_ID: {
+		unsigned int ct_id = (unsigned long)ct;
+		*dest = ct_id;
+		return;
+	}
 	default:
 		break;
 	}
@@ -251,6 +256,9 @@ static void nft_ct_set_zone_eval(const struct nft_expr *expr,
 	case IP_CT_DIR_REPLY:
 		zone.dir = NF_CT_ZONE_DIR_REPL;
 		break;
+	case NFT_CT_ID:
+		len = sizeof(u64);
+		break;
 	default:
 		break;
 	}
-- 
2.23.0

